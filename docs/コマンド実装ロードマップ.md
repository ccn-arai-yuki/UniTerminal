# UniTerminal コマンド実装ロードマップ

## 概要

このドキュメントは、UniTerminalに追加予定のコマンドの実装順序をまとめたものです。

---

## 現在実装済みのコマンド

| コマンド | 説明 |
|---------|------|
| `echo` | テキストを出力 |
| `cat` | ファイル内容を表示 |
| `grep` | パターンマッチング検索 |
| `help` | ヘルプを表示 |
| `pwd` | 現在の作業ディレクトリを表示 |
| `cd` | 作業ディレクトリを変更 |
| `ls` | ディレクトリ内容を一覧表示 |
| `hierarchy` | シーンヒエラルキー表示（Unity固有） |
| `history` | コマンド履歴管理 |
| `find` | ファイル検索 |
| `go` | GameObject操作（Unity固有） |
| `transform` | Transform操作（Unity固有） |
| `less` | ページャー |
| `component` | コンポーネント管理（Unity固有） |
| `property` | プロパティ値操作（Unity固有） |
| `diff` | ファイル差分比較 |

---

## 追加予定コマンド一覧

現在、追加予定のコマンドはありません。全てのコマンドが実装済みです。

---

## 実装順序

### Phase 1: 基盤整備とシンプルなコマンド

**目標:** Unity固有機能の基盤を構築し、簡単なコマンドを追加

#### 1.1 共通ユーティリティ

| ユーティリティ | 役割 | 使用コマンド |
|---------------|------|-------------|
| `GameObjectPath` | パス文字列 ↔ GameObject変換 | hierarchy, go, transform, component, property |
| `TypeResolver` | 文字列 → Component型解決 | component, property |
| `ValueConverter` | 文字列 → Unity型変換 | property, transform |

#### 1.2 コマンド実装

```
1. hierarchy  [★☆☆] - Unity固有機能の基盤、パス解決の検証
2. history    [★★☆] - Terminal拡張が必要、早めに実装
3. find       [★★☆] - 既存のファイルシステム機能を活用
```

**Phase 1 完了条件:**
- [x] GameObjectPathユーティリティ実装 ✅
- [x] hierarchyコマンド実装・テスト完了 ✅
- [x] historyコマンド実装・テスト完了 ✅
- [x] findコマンド実装・テスト完了 ✅

**Phase 1 完了**

---

### Phase 2: GameObject基本操作

**目標:** GameObjectの作成・削除・Transform操作を実装

#### 2.1 コマンド実装

```
4. go         [★★☆] - create, delete, find, info サブコマンド
5. transform  [★☆☆] - 位置/回転/スケール/親子関係
6. less       [★★☆] - ページャー（Unity環境向けバッチモード）
```

**Phase 2 完了条件:**
- [x] goコマンド（基本サブコマンド）実装・テスト完了 ✅
- [x] transformコマンド実装・テスト完了 ✅
- [x] lessコマンド実装・テスト完了 ✅

**Phase 2 完了**

---

### Phase 3: コンポーネント操作

**目標:** コンポーネントの追加・削除・一覧表示を実装

#### 3.1 コマンド実装

```
7. component  [★★☆] - list, add, remove サブコマンド
```

**Phase 3 完了条件:**
- [x] TypeResolverユーティリティ実装 ✅
- [x] componentコマンド実装・テスト完了 ✅

**Phase 3 完了**

---

### Phase 4: 高度な操作

**目標:** Reflectionを使用したプロパティ操作、差分比較を実装

#### 4.1 コマンド実装

```
8. property   [★★★] - Reflectionによる値取得・設定
9. diff       [★★★] - LCSアルゴリズムによる差分検出
```

**Phase 4 完了条件:**
- [x] ValueConverterユーティリティ実装 ✅
- [x] propertyコマンド実装・テスト完了 ✅
- [x] diffコマンド実装・テスト完了 ✅

**Phase 4 完了**

---

### Phase 5: 拡張機能

**目標:** 各コマンドの追加オプション、補完対応

#### 5.1 拡張内容

```
- hierarchy   : フィルタリング機能（名前、コンポーネント、タグ、レイヤー）
- property    : 参照型対応（GameObject、Component）、配列操作
- 全コマンド  : 補完対応強化
```

※ goコマンドのclone, rename, activeサブコマンドはPhase 2で実装済み
※ componentコマンドのenable, disable, infoサブコマンドはPhase 3で実装済み

**Phase 5 完了条件:**
- [x] hierarchyコマンドにフィルタリング機能を追加（-n, -c, -t, -L オプション） ✅
- [x] propertyコマンドに参照型対応を追加（GameObject、Component、Material） ✅
- [x] propertyコマンドに配列インデックスアクセスを追加（property[0]形式） ✅
- [x] property/componentコマンドの補完機能を強化 ✅
- [x] hierarchyコマンドの補完機能を強化（タグ、レイヤー、コンポーネント名） ✅

**Phase 5 完了**

---

## 依存関係図

```
                    ┌─────────────────┐
                    │ GameObjectPath  │
                    │   ユーティリティ │
                    └────────┬────────┘
                             │
         ┌───────────────────┼───────────────────┐
         │                   │                   │
         ▼                   ▼                   ▼
   ┌──────────┐       ┌──────────┐       ┌──────────┐
   │hierarchy │       │    go    │       │transform │
   └──────────┘       └──────────┘       └──────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │  TypeResolver   │
                    │   ユーティリティ │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │   component     │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ ValueConverter  │
                    │   ユーティリティ │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │    property     │
                    └─────────────────┘


   ┌──────────┐       ┌──────────┐       ┌──────────┐
   │  find    │       │  diff    │       │  less    │
   └──────────┘       └──────────┘       └──────────┘
         │                   │                   │
         └───────────────────┴───────────────────┘
                             │
                      (独立して実装可能)


   ┌──────────┐
   │ history  │  ← Terminal拡張が必要
   └──────────┘
```

---

## 見積もり工数

| Phase | コマンド数 | 難易度 | 備考 |
|-------|-----------|--------|------|
| Phase 1 | 3 | ★★☆ | 基盤ユーティリティ含む |
| Phase 2 | 3 | ★★☆ | |
| Phase 3 | 1 | ★★☆ | TypeResolver実装含む |
| Phase 4 | 2 | ★★★ | ValueConverter、LCS実装含む |
| Phase 5 | - | ★★☆ | 各コマンドの拡張 |

---

## 技術的な注意点

### 1. Editor/Runtime の違い

```csharp
#if UNITY_EDITOR
    // Editor専用: Undo対応、SerializedObject使用
    UnityEditor.Undo.RecordObject(obj, "操作名");
#else
    // Runtime: 直接操作
#endif
```

### 2. 非同期処理

Unity APIの多くはメインスレッドでのみ動作するため、コマンド実行は基本的に同期的に行う。

### 3. パフォーマンス

`FindObjectsOfType` などの重い処理は、大規模シーンでの使用に注意が必要。

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2024-XX-XX | 初版作成 |
| 2025-01-15 | Phase 1 完了（hierarchy, history, find コマンド実装） |
| 2025-01-15 | Phase 2 完了（go, transform, less コマンド実装） |
| 2025-01-15 | Phase 3 完了（component コマンド実装、TypeResolver ユーティリティ追加） |
| 2025-01-15 | Phase 4 完了（property, diff コマンド実装、ValueConverter ユーティリティ追加） |
| 2025-01-15 | Phase 5 完了（hierarchyフィルタリング、property参照型/配列操作、補完機能強化） |
| 2025-01-15 | バグ修正（hierarchyコマンドの-l/-Lオプション衝突を解消、-yに変更） |
